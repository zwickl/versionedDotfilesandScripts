
# Source global definitions
if [ -f /etc/bashrc ]; then
	. /etc/bashrc
fi

#determine OS type
OS='unknown'
unamestr=`uname`
if [[ "$unamestr" == 'Linux' ]]; then
   OS='linux'
elif [[ "$unamestr" == 'Darwin' ]]; then
   OS='darwin'
elif [[ ${unamestr:0:6} == 'CYGWIN' ]]; then
   OS='cygwin'
fi

IP='127.0.0.1'
if [[ $OS == 'darwin' ]]; then
#first try getting ethernet address, then airport
    IP=`ipconfig getifaddr en0 &> /dev/null`
    if [ $? = 1 ]; then
        IP=`ipconfig getifaddr en1`
    fi
elif [[ $OS == 'cygwin' ]]; then
    IP=`ipconfig | grep IPv4 | grep -o '[0-9.]*$'`
else
    IP=`hostname -i`
fi

#sytem variables
export PATH=/usr/local/bin:$PATH:$HOME/bin:$HOME/bin/pyscripts:$HOME/bin/biopython:$HOME/bin/generalScripts:$HOME/bin/$MACHTYPE:$NCL_INST/bin
export MANPATH=`manpath`:/home/zwickl/my_usr/share/man/
export PS1="\w/ $ "

#machines
export CSEM=zwickl@dscr-login-05.oit.duke.edu
export DUKE=zwickl@godzilla.acpub.duke.edu
export LONESTAR=zwickl@lonestar.tacc.utexas.edu
export DLONESTAR=dhillis@lonestar.tacc.utexas.edu
export LONEWORK=zwickl@lonestar.tacc.utexas.edu:/work/utexas/ib/zwickl/
export MONTY=zwickl@129.237.138.231
export KU=zwickl@people.ku.edu
export HOME2=zwickl@192.168.2.2
export DESKTOP=zwickl@129.237.139.73
export KWY=zwickl@129.237.24.139
export PHYLO=zwickl@phylo.bio.ku.edu
export HOMECMP="-p 2222 zwickl@66.45.154.119"
export JASPER=zwickl@129.237.138.173
export DANIEL=zwickl@machcdxi.getmyip.com
export HOWIN=129.237.139.38
export MDGPUS=openlab.umiacs.umd.edu
export LAP_BACKUP_PHYLO=$PHYLO:/mnt/backup1/zwickl/laptop/
export SAKURA="zwickl@129.237.138.128"
export LAP=zwickl@129.237.138.142
export BIGRED=dzwickl@bigred.teragrid.iu.edu
export ORRORIN=zwickl@orrorin.nescent.org
export KANG=zwickl@129.237.138.171
export AMAZON=zwickl@ec2-184-72-132-13.compute-1.amazonaws.com
export HAL=zwickl@hal.biosci.arizona.edu

#ssh aliases
alias lonestar='ssh $LONESTAR'
alias dlonestar='ssh $DLONESTAR'
alias csem='ssh zwickl@dscr-login-03.oit.duke.edu'
alias nescent='ssh derrickzwickl@xserve1.nescent.org'
alias orrorin='ssh zwickl@orrorin.nescent.org'
alias duke='ssh zwickl@godzilla.acpub.duke.edu'
alias tunnelToHome='ssh -L 5899:127.0.0.1:5999 -p 2222 zwickl@24.124.109.231'
alias tunnelWithinHome='ssh -L 5899:192.168.2.2:5999  zwickl@192.168.2.2'
alias phylo='ssh $PHYLO'
alias jasper='ssh $JASPER'
alias lap='ssh $LAP'
alias kang='ssh $KANG'
alias hal='ssh $HAL'

#machine dependent stuff

if [ $OS = "darwin" ];then
	export DESK=$HOME/Desktop/
	export DEV=$DESK/GarliDEV/
	export EF=$DESK/efish/april08/
	export WIN=$EF/selection/windowStuff/
	export NCL=$DEV/ncl/
	export NCL_INST=$NCL/ncl-2.1/builds/gccNoDynamic.NCL_CONST_FUNCS/installed/
	export NCL_INSTALL_DIR=$NCL/ncl-2.1/builds/gccNoDynamic/installed/
    export DYLD_LIBRARY_PATH=/usr/local/cuda/lib:$DYLD_LIBRARY_PATH:/Users/zwickl/Desktop/GarliDEV/googleCodeRepo/branches/beagle/beagle-lib/builds/gccDefaults/installed/lib
    #export MAFFT_BINARIES=/usr/local/bin/
    export MAFFT_BINARIES=
    PATH="/Library/Frameworks/Python.framework/Versions/Current/bin:$PATH"
	PATH=$PATH:/usr/local/cuda/bin
	GNUTERM=x11
    export ORYZA=$DEV/experiments/oryza
    alias oryza='cd $ORYZA'
    alias ls='ls -G'
    alias inkscape="/Applications/Inkscape.app/Contents/Resources/bin/inkscape"
elif [ $OS = "cygwin" ];then
	export HOMEDRIVE=/cygdrive/c/
	export DESK=/cygdrive/f/Desk/
	export DEV=$DESK/GarliDEV/
	export NCL=$DEV/ncl/
	export NCL_INST=$NCL/branches/v2.1/builds/gccNoDynamic.NCL_CONST_FUNCS/
	export PROJ=$TRUNK/project/standardGarliVC/
	#export HOMELAP='zwickl@192.168.1.65'
	export HOMELAP='zwickl@192.168.2.6'
	PATH=$PATH:/cygdrive/c/Program\ Files/Java/jre6/bin/
	PATH=$PATH:$HOME/bin/pyscripts/:/cygdrive/c/Program\ Files/NCBI/blast-2.2.25/bin/
	PATH=$PATH:/usr/local/emboss/bin/
	PATH=/usr/bin:$PATH
	alias backupHomeToG='rsync -av --exclude-from=/home/zwickl/.rsyncBackupExclude /cygdrive/c/Documents\ and\ settings/zwickl/ /cygdrive/g/derrickHomeBackup/'
	alias backupHomeToI='rsync -av --exclude-from=/home/zwickl/.rsyncBackupExclude /cygdrive/c/Documents\ and\ settings/zwickl/ /cygdrive/i/derrickHomeBackup/'
	alias backupHomeToJ='rsync -av --exclude-from=/home/zwickl/.rsyncBackupExclude /cygdrive/c/Documents\ and\ settings/zwickl/ /cygdrive/j/derrickHomeBackup/'
	alias syncWorkDeskUp='rsync -avzu --exclude-from=/home/zwickl/.syncExclude /cygdrive/f/Desk/ $MONTY:WIN_SYNC/Desk/'
	alias syncWorkDeskDown='rsync -avz --exclude-from=/home/zwickl/.syncExclude $MONTY:WIN_SYNC/Desk/ /cygdrive/f/Desk/'
    alias ls='ls --color=auto'
elif [ $OS = "linux" ];then
	PATH=/home/zwickl/my_usr/bin/:$PATH:/share/apps/bin/:/share/apps/opt/gdb/bin/:/usr/local/cuda/bin:/share/apps/opt/gcc/bin/
	export PYTHONPATH=/home/zwickl/my_usr/lib/python2.7/:/home/zwickl/my_usr/lib/python/:/share/apps/Python-2.6.4/lib/python2.6/
	export LD_LIBRARY_PATH=/opt/rocks/lib/mysql/:/home/zwickl/googleCodeRepo/branches/beagle/beagle-lib/builds/gccDefault/installed/lib:$LD_LIBRARY_PATH
	export DEV=$HOME
	export NCL=/home/zwickl/ncl/
	export NCL_INST=$NCL/ncl-2.1/builds/gccNoDynamic/installed/
    if [ -d /share/apps/lib/mafft/ ];then
        export MAFFT_BINARIES=/share/apps/lib/mafft/
    else
        export MAFFT_BINARIES=$HOME/my_usr/lib/mafft/
    fi
	alias qa='qstat -u "*" | sort | grep [0-9]' 
	alias qz='qstat | sort | grep [0-9]' 
	alias devQrsh='qrsh -q dev.q -l h_vmem=4G -l vf=4G'
	alias ViewLog='vi $TESTS/RUNLOG.log'
	alias ViewTests='vi $TESTS/TESTRESULTS.log'
	alias c0='ssh compute-0-0'
	alias backupToPhylo='rsync --progress -avz --exclude-from=$HOME/.rsync_exclude $HOME/ $PHYLO:fromKwy/'
fi

#temporary exports
export HYPHY_SCRIPTS=/Applications/HYPHY/hyphySVN/HYPHY/TemplateBatchFiles/
export TESTING_EXEC=/Users/zwickl/Desktop/GarliDEV/googleCodeRepo/trunk/builds/iccAsserts/installed/bin/Garli0.961b
export SAMP=$ROOT_INDEL/singleSite/del2Xins/ranaDepth0.1/totRate0.04/00/
export ASAMP=$ROOT_INDEL/singleSiteAligned/del2Xins/ranaDepth0.1/totRate0.04/00/
export MSAMP=$ROOT_INDEL/multiSite/zipfian1.5/del2Xins/ranaDepth0.1/totRate0.04/00/
export MASAMP=$ROOT_INDEL/multiSiteAligned/zipfian1.5/del2Xins/ranaDepth0.1/totRate0.04/00/


#filesystem locations - largely machine independent
export HYPHY_SCRIPTS=/Applications/HYPHY/hyphySVN/HYPHY/TemplateBatchFiles/
export TRUNK=$DEV/googleCodeRepo/trunk/
export BRANCHES=$DEV/googleCodeRepo/branches/
export BEAG=$BRANCHES/beagle/
export PART=$BRANCHES/partitioning/
export TESTS=$DEV/git/garlitests/
export TB=$TRUNK/builds/
export PB=$PART/builds/

export PART_EXEC=$PART/builds/gccAss/installed/bin/Garli
export PART_EXEC_MPI=$PART/builds/gccAss.MPI/installed/bin/Garli
export PART_EXEC_DEB=$PART/builds/gccAss.DEB/installed/bin/Garli
export TRUNK_EXEC=$TRUNK/builds/gccAss/installed/bin/Garli
export TRUNK_EXEC_MPI=$TRUNK/builds/gccAss.MPI/installed/bin/Garli
export TESTING_EXEC=$PART_EXEC
export TESTING_EXEC_MPI=$PART_EXEC_MPI
export VER2_EXEC=$DEV/googleCodeRepo/tags/2.0-release/builds/gccAss/installed/bin/Garli
export INDEL_SCRIPTS=$DEV/experiments/orientedGapTests/mixedModel.Oct2010/indelibleSims/scripts/
export ROOT_INDEL=$DEV/experiments/orientedGapTests/mixedModel.Oct2010/indelibleSims/
export TANDY_SCRIPTS=$DEV/experiments/orientedGapTests/mixedModel.Oct2010/tandyData/scripts
export ROOT_TANDY=$DEV/experiments/orientedGapTests/mixedModel.Oct2010/tandyData/
export JANSEN_SCRIPTS=$DEV/experiments/orientedGapTests/mixedModel.Oct2010/jansen64/scripts
export ROOT_JANSEN=$DEV/experiments/orientedGapTests/mixedModel.Oct2010/jansen64/
export COMMON_SCRIPTS=$DEV/experiments/orientedGapTests/mixedModel.Oct2010/commonScripts/

export PYTHONPATH=$HOME/bin/pyscripts/:$PYTHONPATH

export ORYZA_ROOT=$DEV/experiments/oryza/
export RELATIVE_ALIGNMENT_PATH_ORYZA=../../alignments/
if [ ! -d "$ORYZA_ROOT" ];then
    export ORYZA_ROOT=/share/work1/zwickl/experiments/oryza/
    #ls $ORYZA_ROOT &> /dev/null
fi
export ANALYSIS_SCRIPTS_ORYZA=$ORYZA_ROOT/scripts/analysisScripts/
export ALIGNMENT_SCRIPTS_ORYZA=$ORYZA_ROOT/scripts/alignmentScripts/
export GENERAL_SCRIPTS_ORYZA=$ORYZA_ROOT/scripts/generalScripts/

export BEAST=/home/zwickl/libbuilds/BEASTv1.6.1/

#command aliases
alias desk='cd $DESK'
alias lsl='ls -ltrh'
alias xterm='xterm -ls'
alias gp='gnuplot'
#alias synHome='synergyc  -f --name newlap 192.168.1.64'
alias synHome='synergyc  -f --name newlap 192.168.2.5'
alias lsl='ls -ltrh'
alias hist='history | grep'
alias mi='nice make -j 2 && nice make install && pwd > $HOME/.lastMake'
alias mc='nice make -j 2 && nice make install && nice make check && pwd > $HOME/.lastMake'
alias dev='cd $DEV'
alias tunk='cd $TRUNK'
alias branch='cd $BRANCHES'
alias fin='grep Final'
alias cdtr='cd `ls -d $TESTS/rev* | tail -1`'
alias cdr='cd "`ls -dtr */ | tail -1`"'
#alias vir='vi `ls -trl . | grep -v "^d" | awk '{print $9}' | tail -n1`'
alias vir='vi `ls -tr . | tail -1`'
alias dush='du -shc *'
alias llog='*.log00.log'
alias cdt='cd $TESTS'
alias tabify="perl -p -i -e 's/[ ]+/\t/g'"
alias vig='vi garli.conf'
#alias dstat="disq_stat"
alias dsub="disq_sub"
alias ddel="disq_del"

alias mark="pwd > $HOME/.markedDir"
alias cdm="cd `cat $HOME/.markedDir`"
alias mark2="pwd > $HOME/.markedDir2"
alias cdm2="cd `cat $HOME/.markedDir2`"
alias mark3="pwd > $HOME/.markedDir3"
alias cdm3="cd `cat $HOME/.markedDir3`"
alias runLast='`cat $HOME/.lastMake`/installed/bin/Garli'
alias debLast='gdb `cat $HOME/.lastMake`/installed/bin/Garli'

#functions

function gits(){
    git status $@ | less
}

function inEachDir(){
	if [ $OS = "darwin" ];then
		source /Users/zwickl/.profile
	        for dir in */
	        do
	               	cd $dir || return 1
	                $@ || return 1
	                cd .. || return 1
	        done
	elif [ $OS = "linux" ];then
	for dir in */
		do
			cd $dir || exit
			$@ || exit
			cd .. || exit
		done
	fi
}

function usedCount(){
	for name in zwickl jeet tracyh mholder joaks1 johnkelly bhurwitz sanderm dboss juliej mcmahonm
	do
		echo -n "$name	"
		qstat -u $name | grep [0-9] | grep -v "qw" | awk '{print $9}' | grep [0-9] | sumCol.py
	done
	echo -n "total	"
	qstat -u "*" | grep [0-9] | grep -v "qw" | awk '{print $9}' | grep [0-9] | sumCol.py
}

function queuedCount(){
	for name in zwickl jeet tracyh mholder joaks1 johnkelly bhurwitz sanderm dboss juliej mcmahonm
	do
		echo -n "$name	"
		qstat -u $name | grep [0-9] | grep qw | awk '{print $8}' | grep [0-9] | sumCol.py
	done
	echo -n "total	"
	qstat -u "*" | grep [0-9] | grep qw | awk '{print $8}' | grep [0-9] | sumCol.py
}

function dstat(){
	for name in zwickl jeet tracyh mholder joaks1 johnkelly
	do
		echo -n "$name	"
		disq_stat -u $name 2>/dev/null
	done
}

function mkcd(){
	mkdir $@
	cd $@
}

function countFastaSeqs(){
    for i in $@
    do
        echo $i
        grep '^>' $i | wc -l
    done
}

function occurenceCount(){
    grep $1 $2 | wc -l
}

if [[ $OS == 'darwin' ]]; then
	function rce(){
		vi $HOME/.profile
		source $HOME/.profile
	}
	function transpose(){
		cat $@ | rs -c -T	

	}
else
	function rce(){
		vi $HOME/.bashrc
		source $HOME/.bashrc
	}
fi

if [[ $OS == 'darwin' ]]; then
    function viewDagchainer(){
        ~/Desktop/code/DAGCHAINER/Java_XY_plotter/run_XYplot.pl $1 $2
    }
fi

function kwy (){
NOPROXY=0
if [[ $OS == 'darwin' ]]; then
    NOPROXY=`ifconfig | grep inet | grep 129.237 | wc -l`
elif [[ $OS == 'cygwin' ]]; then
    NOPROXY=`ipconfig | grep IPv4 | grep 129.237 | wc -l`
fi

    if [ "$NOPROXY" -eq 0 ];then
        ssh -t $PHYLO 'ssh zwickl@129.237.24.139'
     else
        ssh $KWY
     fi
}

function dkwy (){
NOPROXY=0
if [[ $OS == 'darwin' ]]; then
    NOPROXY=`ifconfig | grep inet | grep 129.237 | wc -l`
elif [[ $OS == 'cygwin' ]]; then
    NOPROXY=`ipconfig | grep IPv4 | grep 129.237 | wc -l`
fi

    if [ "$NOPROXY" -eq 0 ];then
        ssh -t $PHYLO 'ssh derrick@129.237.24.139'
     else
        ssh derrick@129.237.24.139
     fi
}

function startScript(){
    echo "#!/bin/bash" > $@ 
    echo >> $@ 
    echo >> $@ 
    vi +3 $@
    chmod +x $@
}

function startGnuplotScript(){
    echo "load ~/versionedScriptsAndDotfiles/generalScripts/default_gnuplot_styles.plt"  > $@
    echo >> $@
    echo >> $@
    vi +3 $@
}

function myqrsh(){
    if [ $# -eq 0 ];then
        MEM=2
    else
        MEM=$@
    fi
    echo qrsh -l h_vmem="$MEM"G -l s_vmem="$MEM"G -l vf="$MEM"G
    qrsh -l h_vmem="$MEM"G -l s_vmem="$MEM"G -l vf="$MEM"G
}

#mac specific
if [[ $OS == 'darwin' ]]; then
	alias temp='sysctl kern.cpu_temp'
	alias top='top -u'
	export COPYFILE_DISABLE=true
	source /opt/intel/cc/9.1.037/bin/iccvars.sh
	export PATH="/Library/Frameworks/Python.framework/Versions/2.7/bin:${PATH}"

elif [[ $OS == 'cygwin' ]]; then
	stty lnext ^q stop undef start undef
	export INPUTRC=$HOME/.inputrc
	alias killall='taskkill /f /im"$1"'
	alias c:='cd /cygdrive/c/'
	alias e:='cd /cygdrive/e/'
	alias f:='cd /cygdrive/f/'
	export CD=/cygdrive/c/
	export ED=/cygdrive/e/
	export FD=/cygdrive/f/

fi

#ignore sucessive duplicate commands
HISTIGNORE=\&
HISTFILESIZE=1000


